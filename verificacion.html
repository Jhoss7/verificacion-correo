<!DOCTYPE html>
<html>
<head>
  <title>Acceso a Google Sheets</title>
</head>
<body>
  <h1>Verificación de Correo Electrónico</h1>
  <p id="verificationStatusMessage">¡Hola, tu correo ha sido VERIFICADito!</p>

  <div id="tokenDisplay">
    <!-- Aquí se mostrará el token -->
  </div>
  <h1>Datos del Google Sheet</h1>
  <div id="sheetData"></div>

  <a href="#" id="saveTokenLink">Guardar Token en Google Sheets</a>

  <script>
    // Obtén el token de la URL
    var urlParams = new URLSearchParams(window.location.search);
    var token = urlParams.get('token');

    // Verifica si se ha encontrado un token en la URL
    if (token) {
      // Muestra el token en el elemento 'tokenDisplay'
      var tokenDisplay = document.getElementById('tokenDisplay');
      tokenDisplay.textContent = 'Token: ' + token;

      // Manejar el evento de clic en el enlace para guardar el token
      var saveTokenLink = document.getElementById('saveTokenLink');
      saveTokenLink.addEventListener('click', function () {
        // Llama a la función para guardar el token en Google Sheets
        guardarTokenEnGoogleSheets(token);
      });
    }

    // Función para guardar el token en Google Sheets
    function guardarTokenEnGoogleSheets(token) {
      // Reemplaza 'TU_JSON_CREDENTIALS' con el contenido de tu archivo de credenciales JSON
      var credentials = {
        "client_id":"816453436793-mfrd0gmqokedqouu4hi8lbolle7tgej6.apps.googleusercontent.com",
        "project_id":"practicasjv","auth_uri":"https://accounts.google.com/o/oauth2/auth",
        "token_uri":"https://oauth2.googleapis.com/token","auth_provider_x509_cert_url":"https://www.googleapis.com/oauth2/v1/certs",
        "client_secret":"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",
        "redirect_uris":["http://localhost:8080/","https://jhoss7.github.io"],
        "javascript_origins":["http://localhost:8080","https://jhoss7.github.io"]}
      };

      // Carga las credenciales de servicio
      gapi.load('client', function () {
        gapi.client.init({
          'clientId': credentials.client_id,
          'scope': 'https://www.googleapis.com/auth/spreadsheets',
        }).then(function () {
          // Identifica la hoja de cálculo donde deseas guardar el token
          var spreadsheetId = '1eO13HkJDyaTu-g7hqr-Wxpm5UzEW0gBnL8EPJOAEdBY';
          var range = 'Hoja 1'; // Cambia a la hoja que necesites

          // Crea un objeto de datos para enviar al Google Sheet
          var values = [[token]];

          // Realiza una solicitud para agregar una fila con el token
          gapi.client.sheets.spreadsheets.values.append({
            spreadsheetId: spreadsheetId,
            range: range,
            valueInputOption: 'RAW',
            insertDataOption: 'INSERT_ROWS',
            values: values,
          }).then(function (response) {
            var result = response.result;
            console.log('Token guardado en Google Sheets:', result);
          });
        });
      });
  </script>
  <script src="https://apis.google.com/js/api.js"></script>
</body>
</html>

